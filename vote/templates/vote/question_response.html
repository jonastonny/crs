{% extends 'main/base.html' %}

{% block content %}
{% load staticfiles %}

    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <script src="http://cdn.jsdelivr.net/vue/1.0.16/vue.min.js"></script>

    <div class="container" height="100%">

        <ol class="breadcrumb">
            <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
            <li><a href="{% url 'room_detail' question.group.room_id %}">{{ question.group.room.title }}</a></li>
            <li><a href="{% url 'questiongroup_detail' question.group.room_id question.group_id %}">{{ question.group.title }}</a></li>
            <li><a href="{% url 'question_detail' question.group.room_id question.group_id question.id %}">{{ question.question_text|truncatechars:20 }}</a></li>

            <li class="active">See responses</li>
        </ol>

            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseQuestion" aria-expanded="false" aria-controls="collapseQuestion">
                Show question
            </button>
        <h1>
            <div class="collapse" id="collapseQuestion">
                {{ question.question_text|safe }}
            </div>
            <small>Total Responses: {{ question.total_responses }}</small>
        </h1>

        <div class="ct-chart" id="chart"></div>

        <input type="hidden" id="event" value="response-{{ room }}{{ questiongroup }}{{ question.id }}">


      <script>
        var chart = new Chartist.Bar('.ct-chart', {
              labels: {{ data.labels|safe }},
              series: {{ data.series }}
            }, {
              low: 0,
              axisY: {
                    onlyInteger: true
              },
              distributeSeries: true
            }
        );

        // Enable pusher logging - don't include this in production
        Pusher.log = function(message) {
          if (window.console && window.console.log) {
            window.console.log(message);
          }
        };
        var pusher = new Pusher('52b285639f1c7195cfac', {
          encrypted: true
        });
        var channel = pusher.subscribe('crs');
        var event = $("#event:hidden").val();
        channel.bind(event, function(data) {
            divs = $(".answer-box");
            divs.each(function(index, value){
                var answerId = parseInt($(value).attr('id'));
                var count = data.data[answerId] ? data.data[answerId].answer_count : 0;
                $(value).text(count);
            });
            chart.update(data.data);
        });
      </script>
    </div>

    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <script src="{% static 'vote/js/pretty.js' %}"></script>

{% endblock %}